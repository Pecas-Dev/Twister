<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Twister Game</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üåµüê°üç§</h1>
            <h1>Twister</h1>
            <p>Get ready to twist and turn!</p>
        </div>

        <!-- Setup Screen -->
        <div class="content setup-screen">
            <div class="section">
                <h2 class="section-title">Add Players</h2>
                <div class="player-input-group">
                    <input type="text" id="playerNameInput" placeholder="Enter player name..." maxlength="20">
                    <button class="btn btn-add" onclick="addPlayer()">Add</button>
                </div>
            </div>

            <div class="section">
                <h2 class="section-title">Players (<span id="playerCount">0</span>)</h2>
                <div id="playersList" class="players-list">
                    <div class="empty-state">No players yet. Add some players to start!</div>
                </div>
            </div>

            <button class="btn btn-secondary" onclick="openSettings()" style="width: 100%; margin-bottom: 12px;">
                ‚öôÔ∏è Settings
            </button>

            <button class="btn btn-start" id="startBtn" onclick="startGame()" disabled>
                Start Game
            </button>
        </div>

        <!-- Game Screen -->
        <div class="content game-screen">
            <div class="game-header">
                <div class="current-player">
                    <span id="currentPlayerName">Player</span>'s Turn
                </div>
                <div class="turn-counter">
                    Turn <span id="turnNumber">1</span>
                </div>
                <button class="settings-btn" onclick="openSettings()">‚öôÔ∏è</button>
            </div>

            <!-- Challenge Banner -->
            <div id="challengeBanner" class="challenge-banner" style="display: none;">
                <div class="challenge-label">‚≠ê Challenge ‚≠ê</div>
                <div class="challenge-text" id="challengeText"></div>
            </div>

            <!-- In-Game Timer Adjustment (only in timer mode) -->
            <div class="ingame-timer-adjust" style="display: none;">
                <button class="timer-btn timer-btn-minus" onclick="adjustTimer(-5)">
                    <img src="images/Leftarrow.png" alt="Decrease">
                </button>
                <div class="timer-display">10s</div>
                <button class="timer-btn timer-btn-plus" onclick="adjustTimer(5)">
                    <img src="images/Rightarrow.png" alt="Increase">
                </button>
            </div>

            <div class="result-display color-waiting">
                <img id="limbIcon" class="limb-icon" src="images/arm.png" alt="Limb" style="display: none;">
                <div class="result-limb" id="resultLimb"></div>
                <div class="result-color-text" id="resultColorText">Ready?</div>
            </div>

            <!-- Timer Countdown Display (only shown in timer mode) -->
            <div class="timer-countdown" style="display: none;">
                <div class="countdown-text">Next turn in</div>
                <div class="countdown-timer" id="countdownTimer">10</div>
            </div>

            <!-- Mini Music Player (now inside the phone UI) -->
            <div id="miniMusicPlayer" class="mini-music-player" style="display: none;">
                <div class="mini-player-info">
                    <div class="now-playing-track" id="miniTrackName">No music playing</div>
                    <div class="now-playing-artist" id="miniArtistName">Connect Spotify in settings</div>
                </div>
                <div class="mini-player-controls">
                    <button class="mini-player-btn" id="miniPlayBtn" onclick="playSpotify()" style="display: none;">‚ñ∂Ô∏è</button>
                    <button class="mini-player-btn" id="miniPauseBtn" onclick="pauseSpotify()" style="display: none;">‚è∏Ô∏è</button>
                    <button class="mini-player-btn" id="miniSkipBtn" onclick="skipSpotify()" style="display: none;">‚è≠Ô∏è</button>
                </div>
            </div>

            <div class="game-controls">
                <button class="btn btn-spin" onclick="nextPlayerManual()">
                    Next Player
                </button>
                <button class="btn btn-secondary" onclick="endGame()">
                    End Game
                </button>
            </div>
        </div>
    </div>

    <!-- Settings Panel Overlay -->
    <div class="settings-overlay" onclick="closeSettings()"></div>
    
    <div class="settings-panel">
        <div class="settings-header">
            <div class="settings-header-content">
                <h2 class="settings-title">Settings</h2>
                <button class="close-settings-btn" onclick="closeSettings()">‚úï</button>
            </div>
        </div>
        
        <div class="settings-content">
            <!-- Turn Mode in Settings -->
            <div class="section turn-mode-section">
                <h2 class="section-title">Turn Mode</h2>
                <div class="mode-toggle">
                    <button class="mode-btn active" data-mode="manual" onclick="setTurnMode('manual'); updateInGameTimerVisibility();">Manual</button>
                    <button class="mode-btn" data-mode="timer" onclick="setTurnMode('timer'); updateInGameTimerVisibility();">
                        Timer
                    </button>
                </div>
                
                <div class="timer-settings">
                    <div class="timer-control">
                        <button class="timer-btn timer-btn-minus" onclick="adjustTimer(-5)">
                            <img src="images/Leftarrow.png" alt="Decrease">
                        </button>
                        <div class="timer-display">10s</div>
                        <button class="timer-btn timer-btn-plus" onclick="adjustTimer(5)">
                            <img src="images/Rightarrow.png" alt="Increase">
                        </button>
                    </div>
                </div>
            </div>

            <!-- Challenge Settings -->
            <div class="section voice-section">
                <h2 class="section-title">Challenges</h2>
                <div class="voice-toggle-container">
                    <span class="voice-label">Enable Challenges</span>
                    <label class="switch">
                        <input type="checkbox" id="challengeToggle" checked onchange="toggleChallenges()">
                        <span class="slider"></span>
                    </label>
                </div>
                
                <div class="challenge-controls active">
                    <div class="section-title" style="font-size: 0.95em; margin-top: 16px; margin-bottom: 8px;">Frequency</div>
                    <div class="mode-toggle">
                        <button class="frequency-btn mode-btn" data-frequency="rare" onclick="setChallengeFrequency('rare')">Rare</button>
                        <button class="frequency-btn mode-btn active" data-frequency="medium" onclick="setChallengeFrequency('medium')">Medium</button>
                        <button class="frequency-btn mode-btn" data-frequency="frequent" onclick="setChallengeFrequency('frequent')">Frequent</button>
                    </div>
                    <p style="font-size: 0.85em; color: #8e8e93; margin-top: 12px; padding: 0 4px; line-height: 1.4;">
                        Challenges appear randomly during gameplay. Frequency affects how often they might appear, but there's always an element of surprise!
                    </p>
                    <!-- Challenges Dropdown List -->
                    <div class="challenge-dropdown">
                    <button class="challenge-dropdown-toggle" onclick="toggleChallengeList()">
                        <span>Manage Challenge Pool</span>
                        <span class="dropdown-arrow">‚ñ∂</span>
                    </button>
                    <div id="challengeListDropdown" style="display: none;">
                        <div id="challengeListContainer" class="challenge-list-container"></div>
                    </div>
                    </div>
                </div>
            </div>

            <!-- Voice Settings in Settings Panel -->
            <div class="section voice-section">
                <h2 class="section-title">Voice Announcements</h2>
                <div class="voice-toggle-container">
                    <span class="voice-label">Enable Voice</span>
                    <label class="switch">
                        <input type="checkbox" id="voiceToggleSettings" checked onchange="toggleVoice()">
                        <span class="slider"></span>
                    </label>
                </div>
                
                <div class="voice-controls active">
                    <div class="voice-control-row">
                        <span class="control-label">Speed</span>
                        <div class="voice-slider-container">
                            <input type="range" id="rateSliderSettings" class="voice-slider" 
                                   min="0.5" max="2" step="0.1" value="1" 
                                   oninput="updateVoiceRate(this.value)">
                            <span class="slider-value" id="rateValueSettings">1.0x</span>
                        </div>
                    </div>
                    
                    <div class="voice-control-row">
                        <span class="control-label">Volume</span>
                        <div class="voice-slider-container">
                            <input type="range" id="volumeSliderSettings" class="voice-slider" 
                                   min="0" max="1" step="0.1" value="1" 
                                   oninput="updateVoiceVolume(this.value)">
                            <span class="slider-value" id="volumeValueSettings">100%</span>
                        </div>
                    </div>
                    
                    <div class="voice-control-row">
                        <span class="control-label">Pitch</span>
                        <div class="voice-slider-container">
                            <input type="range" id="pitchSliderSettings" class="voice-slider" 
                                   min="0.5" max="2" step="0.1" value="1" 
                                   oninput="updateVoicePitch(this.value)">
                            <span class="slider-value" id="pitchValueSettings">1.0</span>
                        </div>
                    </div>
                    
                    <button class="test-voice-btn" onclick="testVoice()">
                        üîä Test Voice
                    </button>
                </div>
            </div>

            <!-- Music/Spotify Settings -->
            <div class="section voice-section">
                <h2 class="section-title">Music</h2>
                
                <!-- Not connected view -->
                <div id="spotifyDisconnected">
                    <button class="spotify-connect-btn" onclick="connectSpotify()">
                        <img src="images/spotify.png" alt="Spotify" style="width: 20px; height: 20px;"> Connect Spotify
                    </button>
                    <p style="font-size: 0.85em; color: #8e8e93; margin-top: 12px; padding: 0 4px; line-height: 1.4;">
                        Play music during your game. <strong>Requires Spotify Premium.</strong>
                    </p>
                </div>

                <!-- Connected view -->
                <div id="spotifyConnected" style="display: none;">
                    <!-- Selected Playlist -->
                    <div class="voice-toggle-container">
                        <div>
                            <div class="voice-label" id="selectedPlaylistName">No playlist</div>
                            <div style="font-size: 0.85em; color: #8e8e93; margin-top: 2px;" id="playlistStatus">Select a playlist to play</div>
                        </div>
                        <button class="btn btn-secondary" style="padding: 8px 16px; font-size: 0.9em;" onclick="document.getElementById('playlistSearch').focus(); document.getElementById('playlistSearchContainer').style.display = 'block';">Change</button>
                    </div>

                    <!-- Search Playlists (hidden by default) -->
                    <div id="playlistSearchContainer" style="display: none; margin-top: 12px;">
                        <input 
                            type="text" 
                            id="playlistSearch" 
                            class="playlist-search-input" 
                            placeholder="Search playlists..."
                            oninput="if(this.value.length > 2) searchPlaylists(this.value)"
                        >
                        <div id="playlistResults" class="playlist-results"></div>
                    </div>

                    <button class="spotify-disconnect-btn" onclick="disconnectSpotify()">
                        Disconnect
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="spotify.js"></script>
    <script src="script.js"></script>
</body>
</html>
